<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>condor-web</title>
</head>

<style>
   * {
      font-family: Arial, Helvetica, sans-serif;
   }

   .course {
      width: 500px;
      height: auto;
      color: white;
      background-color: #005599;
      border: 2px solid black;
      margin-top: 10px;
      padding: 5px 20px;
      border-radius: 100px;
   }
</style>

<body>
   <h1><code>condor-web</code></h1>

   <label for="season-input">Season</label>
   <select id="season-input" name="season">
      <option value="winter">Winter</option>
      <option value="fall">Fall</option>
   </select>

   <label for="year-input">Year</label>
   <input id="year-input" type="text" placeholder="2025" value="2025" size="4" />
   </select>

   <br><br>

   <label for="crn-input">CRN</label>
   <input id="crn-input" type="text" placeholder="22418" />

   <br><br>

   <button id="add-class-btn">Add class</button>

   <div id="courses"></div>
</body>

<script type="module">
   let crns = [];

   async function addPill(crn, season, year) {
      const response = await fetch(`/api/get_course?crn=${crn}&year=${year}&season=${season}`);
      const json = await response.text();
      const obj = JSON.parse(json);

      let course = document.createElement("div");
      course.className = "course"

      course.innerHTML = `<b>${obj["code"]}: ${obj["title"]}</b><br>
Capacity: ${obj["actual_capacity"]}<br>
Remaining seats: ${obj["actual_remaining"]}`;

      document.getElementById("courses").appendChild(course);

   }

   document.getElementById("add-class-btn").addEventListener("click", async function () {
      let inputBox = document.getElementById("crn-input");

      const crn = inputBox.value;

      // Clear input box.
      inputBox.value = "";

      if (crns.includes(crn)) {
         console.log(`Duplicate CRN: ${crn}. Returning.`);
         return;
      }

      if (crn.match(/^\s*$/)) {
         console.log("CRN all whitespace. Returning.");
         return;
      }

      const season = document.getElementById("season-input").value

      const year = document.getElementById("year-input").value

      console.log(`Adding CRN: ${crn} for ${season} ${year}`);

      crns.push(crn);
      await addPill(crn, season, year)
   })
</script>

</html>
